%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RS.STY  Style File for Royal Society Series A Journals %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Copyright (C) 1992 Cambridge University Press
% This version maintained by the Production Office at the
% Royal Society, 6 Carlton House Terrace, London SW1Y 5AG
% Tel 0171 839 5561 ext. 2639 Fax 0171 976 1837
% Email ezmb014@mailbox.ulcc.ac.uk

\typeout{Document style `Royal Society Series A Journal Style'}

\@twosidetrue
\@mparswitchtrue
\def\ds@draft{\overfullrule 5pt}
\def\ds@proc{\gdef\@journal{Proc.\ R.\ Soc.\ Lond.}}
\def\ds@trans{\gdef\@journal{Phil.\ Trans.\ R.\ Soc.\ Lond.}}
\def\@journal{Phil.\ Trans.\ R.\ Soc.\ Lond.}

\let\@oldtabarray=\@tabarray
\def\array{\let\@acol\@arrayacol \let\@classz\@arrayclassz
 \let\@classiv\@arrayclassiv \let\\\@arraycr\let\@halignto\@empty\@oldtabarray}

\def\footnotesize{\@setsize\footnotesize{10pt}\viiipt\@viiipt% 8 on 10
 \abovedisplayskip 5pt plus 1pt minus 2pt
 \belowdisplayskip \abovedisplayskip
 \abovedisplayshortskip 2pt plus 1pt
 \belowdisplayshortskip  \abovedisplayshortskip
}

\let\xvipt\xviipt
\let\@xvipt\@xviipt

\lineskip 1pt
\normallineskip 1pt
\def\baselinestretch{1}
\def\@normalsize{\@setsize\normalsize{12pt}\xipt\@xipt% 11 on 12
 \abovedisplayskip 6.5pt plus 1pt minus 2pt
 \belowdisplayskip \abovedisplayskip
 \abovedisplayshortskip 3pt plus 1pt
 \belowdisplayshortskip  \abovedisplayshortskip}
\def\small{\@setsize\small{10pt}\ixpt\@ixpt% 9 on 10
 \abovedisplayskip 6pt plus 1pt minus 2pt
 \belowdisplayskip \abovedisplayskip
 \abovedisplayshortskip 3pt plus 1pt
 \belowdisplayshortskip  \abovedisplayshortskip}
\def\indexsize{\@setsize\indexsize{9pt}\viiipt\@viiipt} % 8 on  9
\def\scriptsize{\@setsize\scriptsize{8pt}\viipt\@viipt} % 7 on 8
\def\tiny{\@setsize\tiny{6pt}\vpt\@vpt} % 5 on 6
\def\large{\@setsize\large{12.5pt}\xipt\@xipt} % 11 on 12.5
\def\Large{\@setsize\Large{18pt}\xivpt\@xivpt} % 14 on 18
\def\LARGE{\@setsize\LARGE{19pt}\xvipt\@xvipt} % 16 on 19
\def\huge{\@setsize\huge{25pt}\xxpt\@xxpt} % 20 on 25
\def\Huge{\@setsize\Huge{30pt}\xxvpt\@xxvpt} % 25 on 30
\normalsize

%%%%%%%%%%%%%%%
% PAGE LAYOUT %
%%%%%%%%%%%%%%%

% Side margins
\oddsidemargin  2pc
\evensidemargin 2pc
\marginparwidth 2.0cm
\marginparsep 10pt

% Vertical spacing
\topmargin 2.5pc
\headheight 12pt
\headsep 8pt
\topskip 12pt
\footheight 8pt
\footskip 18pt
\newskip\halflineskip
\halflineskip=6pt plus .5pt minus .5pt

% Dimensions of text
\textheight = 48\baselineskip \advance\textheight by \topskip
\textwidth 32pc
\columnsep 10pt
\columnseprule 0pt

% Footnotes
\footnotesep 2pt
\skip\footins 18pt plus 1pt

% Floats
\floatsep 6pt plus 6pt minus 4pt
\textfloatsep=1.1\floatsep
\intextsep\floatsep
\@maxsep 15pt
\dblfloatsep\floatsep
\dbltextfloatsep\floatsep
\@dblmaxsep\floatsep
\@fptop 0pt plus 0fil
\@fpsep 10pt plus 0fil
\@fpbot 0pt plus 3fil
\@dblfptop 0pt plus 0fil
\@dblfpsep 10pt plus 0fil
\@dblfpbot 0pt plus 3fil
\marginparpush 5pt

%%%%%%%%%%%%%%%%
% PARAGRAPHING %
%%%%%%%%%%%%%%%%

\parskip 0pt
\parindent 1em
\partopsep 0pt plus 1pt
\@lowpenalty   51
\@medpenalty  151
\@highpenalty 301
\@beginparpenalty -\@lowpenalty
\@endparpenalty -\@lowpenalty
\@itempenalty -\@lowpenalty
\clubpenalty=0
\widowpenalty=10000

%%%%%%%%%
% PARTS %
%%%%%%%%%

\def\part{\par \addvspace{4ex}\@afterindentfalse
 \secdef\@part\@spart}
\def\@part[#1]#2{\ifnum \c@secnumdepth >\m@ne
  \refstepcounter{part}
  \addcontentsline{toc}{part}{Part \thepart: #1}
 \else \addcontentsline{toc}{part}{#1}
 \fi
 {\parindent 0pt \centering %changed ggw
  \ifnum \c@secnumdepth >\m@ne
   \large\rm PART
   \ifcase\thepart \or ONE \or TWO \or THREE \or FOUR \or FIVE
    \or SIX \or SEVEN \or EIGHT \or NINE \or TEN \else \fi
   \par \nobreak
  \fi
  \LARGE \rm #2 \markboth{}{}\par }
 \nobreak \vskip 3ex \@afterheading}
\def\@spart#1{{\parindent 0pt \centering % changed ggw
  \LARGE \rm #1\par}
 \nobreak \vskip 3ex \@afterheading}

%%%%%%%%%%%%
% SECTIONS %
%%%%%%%%%%%%

\def\section{\setcounter{equation}{0}
 \@startsection {section}{1}{\z@}
 {19pt plus 2pt minus 1pt}
 {6pt plus .5pt minus .3pt}
 {\centering\large\bf}}
\def\subsection{\@startsection{subsection}{2}{\z@}
 {9pt plus 1pt minus 1pt}
 {3pt plus .1pt minus .1pt}
 {\centering\normalsize\it}}
\def\subsubsection{\@startsection{subsubsection}{3}{\z@}
 {9pt plus 1pt minus 1pt}
 {3pt plus .1pt minus .1pt}
 {\raggedright\normalsize}}
\def\paragraph{}
\def\subparagraph{}

\def\@sect#1#2#3#4#5#6[#7]#8{%
 \ifnum #2>\c@secnumdepth
  \def\@svsec{}%
 \else
  \refstepcounter{#1}
  \ifnum #2=1
   \edef\@svsec{\ifappendix Appendix \fi\csname the#1\endcsname.\hskip0.5em}
  \fi
  \ifnum #2=2
   \edef\@svsec{$($\csname the#1\endcsname$)$\hskip0.5em}
  \fi
  \ifnum #2=3
   \edef\@svsec{$($\csname the#1\endcsname$)$\hskip0.5em}
  \fi
 \fi
 \@tempskipa #5\relax
 \ifdim \@tempskipa>\z@
  \begingroup #6\relax
   \@hangfrom{\hskip #3\relax\@svsec}{\interlinepenalty \@M #8\par}
  \endgroup
  \csname #1mark\endcsname{#7}%
  \ifnum #2=1% sections only
   \addcontentsline{toc}{#1}{\ifnum #2>\c@secnumdepth \else
    \ifappendix\protect\hskip\@tempdima Appendix~\csname the#1\endcsname. #7%
    \else \protect\numberline{\csname the#1\endcsname.}\quad #7\fi\fi}
  \else
   \addcontentsline{toc}{#1}{\ifnum #2>3 \else
\protect\numberline{{\rm(}{\it\csname the#1\endcsname}{\rm)}}\quad #7 \fi}
  \fi
 \else
  \def\@svsechd{#6\hskip #3\@svsec #8\csname #1mark\endcsname {#7}
    \addcontentsline{toc}{#1}{\ifnum #2>\c@secnumdepth \else
     \protect\numberline{\csname the#1\endcsname.}\fi#7}
  }%
 \fi
 \@xsect{#5}}

\newif\ifappendix \appendixfalse
\def\appendix{\par
 \setcounter{section}{0}
 \def\section{\setcounter{equation}{0}
 \@startsection {section}{1}{\z@}
 {19pt plus 2pt minus 1pt}
 {6pt plus .5pt minus .3pt}
 {\centering\large\bf}}
 \def\thesection{\Alph{section}}
 \def\thesubsection{\alph{subsection}}
 \def\thesubsubsection{\roman{subsubsection}}
 \def\theequation{\protect{\thesection\,\arabic{equation}}}
 \appendixtrue}

\setcounter{secnumdepth}{3}

%%%%%%%%%%%%%%%%%%%%%%%%%%
% PART & SECTION NUMBERS %
%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcounter{part}
\newcounter{section}
\newcounter{subsection}[section]
\newcounter{subsubsection}[subsection]
\newcounter{paragraph}[subsubsection]
\def\thepart          {\arabic{part}}
\def\thesection       {\arabic{section}}
\def\thesubsection    {\alph{subsection}\kern 2pt}
\def\thesubsubsection {\roman{subsubsection}}
\def\theparagraph     {\thesubsubsection.\arabic{paragraph}}

%%%%%%%%%
% SKIPS %
%%%%%%%%%

\newskip\@indentskip
\newskip\smallindent
\newskip\@footindent
\newskip\@leftskip
\@indentskip=2.5em
\smallindent=1em
\@footindent=\smallindent
\@leftskip=\z@

%%%%%%%%%
% LISTS %
%%%%%%%%%

\leftmargini\z@
\labelsep\z@
\labelwidth\z@

\def\makeitemlabel#1{\hfill #1}

\def\@listI{\parsep\z@ \topsep\z@ \partopsep\z@ \itemsep\z@ \rightmargin\z@
 \leftmargin\labelwidth \advance\leftmargin\labelsep}
\def\@listi{\@listI \leftmargin\leftmargini \itemindent 1em}
\def\@listii{\@listI \advance\leftmargin 1em}
\def\@listiii{\@listI}
\def\@listiv{\@listI}
\def\@listv{\@listI}
\def\@listvi{\@listI}
\@listi

% Itemize
\def\itemize{\ifnum \@itemdepth >3 \@toodeep
 \else \advance\@itemdepth \@ne
  \edef\@itemitem{labelitem\romannumeral\the\@itemdepth}%
  \list{\csname\@itemitem\endcsname}%
  {\labelsep .5em \settowidth{\labelwidth}{\csname\@itemitem\endcsname}
    \let\makelabel\makeitemlabel}%
 \fi}
\def\labelitemi{$\bullet$}
\def\labelitemii{$\circ$}
\def\labelitemiii{---}
\def\labelitemiv{--} % ggw

% Enumerate
\def\enumerate{\ifnum \@enumdepth >3 \@toodeep
 \else \advance\@enumdepth \@ne
 \edef\@enumctr{enum\romannumeral\the\@enumdepth}\fi
 \@ifnextchar [{\@enumeratetwo}{\@enumeratetwo[i]}}
\def\@enumeratetwo[#1]{%
 \list{\csname label\@enumctr\endcsname}%
  {\settowidth\labelwidth{#1} \labelsep .5em
   \advance\itemindent\labelsep \advance\itemindent\labelwidth
   \usecounter{\@enumctr}}}

\def\labelenumi{(\theenumi)}
\def\theenumi{\roman{enumi}}
\def\labelenumii{({\it\theenumii})}
\def\theenumii{\alph{enumii}}
\def\p@enumii{\theenumi.\theenumii}
\def\labelenumiii{\theenumiii.}
\def\theenumiii{\roman{enumiii}}
\def\p@enumiii{\p@enumii.\theenumiii}
\def\labelenumiv{\theenumiv}
\def\theenumiv{\roman{enumiv}}
\def\p@enumiv{\p@enumiii.\theenumiv}

% Description
\def\descriptionlabel#1{\hspace\labelsep \bf #1}
\def\description{\list{}{\labelwidth\z@
  \ifnum\@listdepth=1\else\advance\leftmargin 1em\fi
  \let\makelabel\descriptionlabel}}
\let\enddescription\endlist

%%%%%%%%%%%%%%%%%%
% DISPLAYED TEXT %
%%%%%%%%%%%%%%%%%%

% Verse
\def\verse{\let\\=\@centercr
 \list{}{\itemsep\z@
  \itemindent -\@indentskip
  \listparindent \itemindent
  \rightmargin\leftmargin
  \advance\leftmargin \@indentskip}\item[]}
\let\endverse\endlist

% Quotation
\def\quotation{\list{}{\listparindent 0pt
  \itemindent\listparindent
  \leftmargin 1em\rightmargin\leftmargin
  \topsep\halflineskip
  \parsep 0pt plus 1pt}\item[]}
\let\endquotation=\endlist

% Quote
\let\quote\quotation
\let\endquote=\endlist

%%%%%%%%%%%%%%%%%%%%%%
% OTHER ENVIRONMENTS %
%%%%%%%%%%%%%%%%%%%%%%

% Theorem
\newenvironment{definition}{\par\addvspace{\halflineskip}
\refstepcounter{theorem}{\it Definition~\thetheorem}.%
 \hskip.5em\ignorespaces}%
 {\vskip\halflineskip\par}

\def\@begintheorem#1#2{\par\addvspace{\halflineskip}%
 {\bf #1\ #2.}\hskip.5em\sl}
\def\@opargbegintheorem#1#2#3{\par\vskip\halflineskip
 {\bf #1\ #2.\ {\rm (#3)}.}\hskip.5em\sl}
\def\@endtheorem{\vskip\halflineskip\par}

% Proof
\newsavebox{\proofbox}
\sbox{\proofbox}{\rule{7pt}{7pt}}
\def\proof{\par\addvspace{\halflineskip}%
 {\it Proof.}\hskip.5em\ignorespaces}
\def\endproof{\hspace*{\fill}\usebox{\proofbox}%
 \vskip\halflineskip\par}
\@namedef{proof*}{\proof}
\@namedef{endproof*}{\vskip\halflineskip\par}

% Remark
\def\newremark#1#2{\newenvironment{#1}{%
 \list{}{\topsep\halflineskip \labelwidth\z@
 \labelsep .5em\let\makelabel\makeitemlabel} \item[{\it #2.}]}{\endlist}}

% Equation and eqnarray
\def\theequation{\thesection.\arabic{equation}}
\jot=4pt
\def\eqnarray{\stepcounter{equation}\let\@currentlabel=\theequation
\global\@eqnswtrue\global\@eqcnt\z@\tabskip\@centering\let\\=\@eqncr
$$\halign to \displaywidth\bgroup\@eqnsel\hskip\@centering
  $\displaystyle\tabskip\z@{##}$&\global\@eqcnt\@ne
  \hfil${\;##\;}$\hfil
  &\global\@eqcnt\tw@ $\displaystyle\tabskip\z@{##}$\hfil
  \tabskip\@centering&\llap{##}\tabskip\z@\cr}

% Titlepage
\def\titlepage{\@restonecolfalse\if@twocolumn\@restonecoltrue\onecolumn
  \else \newpage \fi \thispagestyle{empty}\c@page\z@}
\def\endtitlepage{\if@restonecol\twocolumn \else \newpage \fi}

\arraycolsep 4pt
\tabcolsep 3pt
\arrayrulewidth .5pt
\doublerulesep 1.5pt
\tabbingsep \labelsep
\skip\@mpfootins=0pt
\fboxsep=3pt
\fboxrule=.5pt

%%%%%%%%%%%%%%%%%%%%%%
% TITLE AND ABSTRACT %
%%%%%%%%%%%%%%%%%%%%%%

\def\affiliation#1{\gdef\@affiliation{#1}}
\gdef\@affiliation{}

\def\maketitle{\appendixfalse\@ifnextchar%
  [{\m@ketitleone}{\m@ketitletwo}}%
\def\m@ketitletwo{\m@ketitleone[n]}
\def\m@ketitleone[#1]{\par\begingroup
  \newpage \global\@topnum\z@
  \@maketitle{#1}\thispagestyle{titlepage} \@thanks
  \endgroup
  \setcounter{footnote}{0}
  \let\maketitle\relax \let\@maketitle\relax \gdef\@affiliation{}
  \gdef\@thanks{}\gdef\@author{}\gdef\@title{}\let\thanks\relax}

\def\@maketitle#1{
 \newpage
 \vspace*{10pt}
 {\centering \sloppy
  {\LARGE\bf \@title \par}
  \vskip 16pt plus 2pt minus 1pt
  {\sc B\,y\ \@author \par}
  \vskip 3pt plus 1pt
  {\it \@affiliation \par}
 \par}
 \vskip 20pt plus 2pt minus 1pt
}

\def\abstract{\par\normalsize\noindent\ignorespaces}
\def\endabstract{\par\vskip 9pt plus 1pt minus 1pt
 \vbox{\centerline{\rule[4pt]{30pc}{.4pt}}}\vskip 9pt plus 1pt minus 1pt\par}

%%%%%%%%%%%%%%%
% PAGE STYLES %
%%%%%%%%%%%%%%%

\mark{{}{}}
\gdef\@author{\mbox{}}
\def\author{\@ifnextchar [{\@authortwo}{\@authorone}}
\def\@authortwo[#1]#2{\gdef\@author{#2}\gdef\@shortauthor{#1}}
\def\@authorone#1{\gdef\@author{#1}
 \begingroup\def\and{and}\gdef\@shortauthor{#1}\endgroup}
\def\shortauthor#1{\gdef\@shortauthor{#1}}
\gdef\@shortauthor{}
\gdef\@title{\mbox{}}
\def\title{\@ifnextchar [{\@titletwo}{\@titleone}}
\def\@titletwo[#1]#2{\gdef\@title{#2}\gdef\@shorttitle{#1}}
\def\@titleone#1{\gdef\@title{#1}\gdef\@shorttitle{#1}}
\def\shorttitle#1{\gdef\@shorttitle{#1}}
\gdef\@shorttitle{}

\def\series#1{\gdef\@series{#1}}
\gdef\@series{A}
\def\year#1{\gdef\@year{#1}}
\gdef\@year{1996}
\def\volume#1{\gdef\@volume{#1}}
\gdef\@volume{(Submitted)}
\newsavebox{\RSfootbox}
\sbox{\RSfootbox}{\footnotesize{\it\@journal}\ \rm\@series\ (\@year)}
\def\ps@headings{\let\@mkboth\markboth
\def\@oddhead{\phantom{\rm \thepage}\hfil{\it \@shorttitle}
\hfil\rm \thepage}
\def\@oddfoot{\usebox{\RSfootbox}\hfil}
\def\@evenhead{\rm \thepage \hfil \it \@shortauthor%
 \hfil\phantom{\rm \thepage}}
\def\@evenfoot{\@oddfoot}
\def\sectionmark##1{\markboth{##1}{}}
\def\subsectionmark##1{\markright{##1}}}
\def\ps@myheadings{\let\@mkboth\@gobbletwo
\def\@oddhead{\it \rightmark \hfill \rm \thepage}
\def\@oddfoot{}
\def\@evenhead{\it \leftmark \hfill \rm \thepage}
\def\@evenfoot{}
\def\sectionmark##1{}
\def\subsectionmark##1{}}
\def\ps@titlepage{\let\@mkboth\@gobbletwo
\def\@oddfoot{\raisebox{0pt}[8pt][0pt]{%
  \parbox[t]{\textwidth}{\footnotesize\usebox{\RSfootbox} {\bf\@volume}
  \hfill {\rm\@year\ Royal Society Typescript}\\[2pt]
  {\it Printed in Great Britain}\hphantom{\TeX\ Paper}
  \hfill {\small\rm\thepage} \hfill\hphantom{{\it Printed in 
  Great Britain}} \TeX\ Paper}}}
\def\@oddhead{}\def\@evenhead{}\let\@evenfoot\@oddfoot
\def\sectionmark##1{}\def\subsectionmark##1{}}

%%%%%%%%%%%%%%%%%%%%%
% TABLE OF CONTENTS %
%%%%%%%%%%%%%%%%%%%%%

\def\@pnumwidth{1.55em}
\def\@tocrmarg {2.55em}
\def\@dotsep{4.5}
\setcounter{tocdepth}{2}
\def\@undottedtocline#1#2#3#4#5{\ifnum #1>\c@tocdepth
 \else
  \vskip \z@ plus .2pt
  {\hangindent #2\relax
   \rightskip \@tocrmarg \parfillskip-\rightskip
   \parindent #2\relax \@afterindenttrue
   \interlinepenalty\@M \leavevmode
   \@tempdima #3\relax
   {\rm #4}\nobreak \hfill \nobreak
   \hbox to\@pnumwidth{\hfil\rm #5}\par}\fi}
\def\tableofcontents{\@restonecolfalse
 \if@twocolumn\@restonecoltrue\onecolumn\fi
 \vskip 4pt plus .5pt
 \centerline{\large\bf Contents} \mbox{}\hfill {\sc page}
 \vskip 2pt
 \@starttoc{toc}
 \if@restonecol\twocolumn\fi \par\vspace{12pt}}

\def\l@section#1#2{\addpenalty{\@secpenalty}
 \@tempdima 1.5em
 \begingroup
  \parindent\z@ \rightskip\@pnumwidth \parfillskip -\@pnumwidth
  \rm\leavevmode \advance\leftskip\@tempdima
  \hskip-\leftskip {#1}\nobreak\hfil
  \nobreak\hbox to\@pnumwidth{\hss #2}\par
 \endgroup}
\def\l@subsection{\@tempdima 3.2em\@undottedtocline{2}{1.5em}{5mm}}
\def\l@subsubsection{\@tempdima 4.9em\@undottedtocline{3}{3.8em}{3.2em}}

%%%%%%%%%%%%%
% THE INDEX %
%%%%%%%%%%%%%

\newif\if@restonecol
\def\theindex{\section*{Index}
 \addcontentsline{toc}{section}{Index}
 \footnotesize \parindent\z@ \parskip\z@ plus .1pt\relax
 \let\item\@idxitem}
\def\@idxitem{\par\hangindent 1em}
\def\subitem{\par\hangindent 1em \hspace*{1em}}
\def\subsubitem{\par\hangindent 1em\hspace*{1em}}
\def\endtheindex{\if@restonecol\onecolumn\else\clearpage\fi}
\def\indexspace{\par\vskip\baselineskip \relax}

%%%%%%%%%%%%%
% FOOTNOTES %
%%%%%%%%%%%%%

\def\footnoterule{\setcounter{footnote}{0}}
\def\@makefntext#1{\hskip1em\@thefnmark\hskip.5em\ignorespaces #1}
\def\@fnsymbol#1{\ifcase#1\or \dag\or \ddag\or \P\or \|\or
 \dag\dag\or \ddag\ddag\or \P\P\or \|\| \else\@ctrerr\fi\relax}
\def\@makefnmark{\hbox{\@thefnmark}}% used in text
\def\thempfootnote{\hbox{$^\alph{mpfootnote}$}}

%%%%%%%%%%%%%%%%%%%%%%
% FIGURES AND TABLES %
%%%%%%%%%%%%%%%%%%%%%%

\setcounter{topnumber}{3}
\def\topfraction{0.9}
\setcounter{bottomnumber}{1}
\def\bottomfraction{0.9}
\setcounter{totalnumber}{4}
\def\textfraction{0.001}
\def\floatpagefraction{0.9}
\setcounter{dbltopnumber}{3}
\def\dbltopfraction{.9}
\def\dblfloatpagefraction{.5}

\long\def\@makecaption#1#2{\vskip3pt\begingroup\small
  \setbox\@tempboxa\hbox{{\rm #1.} \fcap@type #2}
  \ifdim \wd\@tempboxa >2\hsize \parbox{\textwidth}{\unhbox\@tempboxa}
  \else {\centering \unhbox\@tempboxa\par} \fi \endgroup\vskip3pt}

\newcounter{table}
\def\thetable{\@arabic\c@table}
\def\fps@table{tp}
\def\ftype@table{1}
\def\ext@table{lot}
\def\fnum@table{Table~\thetable}
\def\table{\let\fcap@type\it
 \@float{table}\small}
\def\plaintable{\@float{table}}
\let\endplaintable\end@float
\let\endtable\end@float
\@namedef{table*}{\@dblfloat{table}}
\@namedef{endtable*}{\end@dblfloat}
\def\fstyle@table{\small\rm}
\def\fjust@table{\centering}
\def\fcapjust@table{\centering}
\def\fcapsize@table{\small\rm}
\def\fcapstyle@table{\small\it}

\newcounter{figure}
\def\thefigure{\@arabic\c@figure}
\def\fps@figure{tp}
\def\ftype@figure{2}
\def\ext@figure{lof}
\def\fnum@figure{Figure~\thefigure}
\def\figure{\let\fcap@type\rm%
 \@float{figure}}
\let\endfigure\end@float
\@namedef{figure*}{\@dblfloat{figure}}
\@namedef{endfigure*}{\end@dblfloat}
\def\fstyle@figure{\small\rm}
\def\fjust@figure{\centering}
\def\fcapjust@figure{\centering}
\def\fcapsize@figure{\small\rm}
\def\fcapstyle@figure{\small\rm}
\newif\ifwide@float
\wide@floatfalse

\def\@dblfloat{\wide@floattrue\@float}
\def\end@dblfloat{\if@twocolumn\egroup
 \ifnum\@floatpenalty <\z@ \@cons\@dbldeferlist\@currbox\fi
 \ifnum \@floatpenalty =-\@Mii \@esphack\fi\else\end@float\fi
 \wide@floatfalse}

\let \oldtabular \tabular
\let \endoldtabular \endtabular

\def\tabular{\def\@halignto{to \textwidth}%
 \tabskip=\tabcolsep plus 1fil\@tabular}
\def\@tabarray{\@ifnextchar[{\@tarray}{\@ttarray}}
\def\@tarray[#1]#2{\t@barray[#1]{@{\tabskip=2\tabcolsep plus 3pt}#2}}
\def\@ttarray#1{\t@barray[c]{@{\tabskip=2\tabcolsep plus 3pt}#1}}
\def\t@barray[#1]#2{\setbox\@arstrutbox=\hbox{\vrule
     height\arraystretch \ht\strutbox
     depth\arraystretch \dp\strutbox
     width\z@}\@mkpream{#2}\edef\@preamble{\halign \noexpand\@halignto
\bgroup \tabskip\z@ \@arstrut \@preamble \tabskip=\tabcolsep plus 1fil \cr}%
\let\@startpbox\@@startpbox \let\@endpbox\@@endpbox
  \if #1t\vtop \else \if#1b\vbox \else \vcenter \fi\fi
  \bgroup \let\par\relax
  \let\@sharp##\let\protect\relax \lineskip\z@\baselineskip\z@\@preamble}

%%%%%%%%%%%%%%%%
% CUP SPECIALS %
%%%%%%%%%%%%%%%%

\renewcommand{\thefootnote}{\mbox{$\fnsymbol{footnote}$}}
\def\sect#1{\hbox{\S\,{#1}}}
\def\hline{\noalign{\ifnum0=`}\fi \vskip 6pt
 \hrule \@height \arrayrulewidth \vskip 6pt
 \futurelet \@tempa\@xhline}
\def\@xhline{\ifx\@tempa\hline \vskip -12pt
 \vskip \doublerulesep \fi \ifnum0=`{\fi}}
\newenvironment{acknowledgments}{
 \par\addvspace{\halflineskip}\noindent\small\ignorespaces}{\par}
\def\discussion{\par\addvspace{22pt plus 1pt minus 1pt}
 \centerline{{\it Discussion}} \vskip4pt}
\def\comment{\par\addvspace{12pt}\noindent\ignorespaces}
\def\received#1{\par\addvspace{\halflineskip}\centerline{\footnotesize\it #1}}

%%%%%%%%%%%%%%%%%
% MISCELLANEOUS %
%%%%%%%%%%%%%%%%%

\newif\ifseqeqn\seqeqnfalse

\def\today{\number\day\ \ifcase\month\or
  January\or February\or March\or April\or May\or June\or
  July\or August\or September\or October\or November\or December
 \fi \ \year}

%%%%%%%%%%%%%%%%
% BIBLIOGRAPHY %
%%%%%%%%%%%%%%%%

\def\@biblabel#1{#1}
\def\thebibliography#1{\par\section*{References}
\addcontentsline{toc}{section}{\enskip\enskip\kern1pt References}
 \list{}{\labelwidth\z@ \leftmargin 1em \itemindent -1em \itemsep 1pt}
 \small \parindent\z@
 \parskip 1.5pt plus .1pt minus 1pt\relax
 \def\newblock{\hskip .11em plus .33em minus .07em}
 \sloppy\clubpenalty4000\widowpenalty4000
 \sfcode`\.=1000\relax}
\let\endthebibliography=\endlist

\let\endthediscbibliography=\endlist

\newlength{\bibhang}
\setlength{\bibhang}{1em}

%%%%%%%%%%%%%%%%%%
% INITIALIZATION %
%%%%%%%%%%%%%%%%%%

\ps@headings
\pagenumbering{arabic}
\onecolumn \let\onecolumn=\relax
\def\twocolumn{\typeout{Two column mode not available with RS style.}}
\flushbottom
\frenchspacing
\newcommand{\mysubsubsection}[1]{\subsubsection{{\it#1}}}
\baselineskip 12pt plus .5pt minus .5pt

%%%%%%%%%%%%%%%%%%%%%%%%
% ROYAL SOCIETY MACROS %
%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%
%    CONTENTS            %
% ====================== %   
% 1. EDITING MACROS      %
% 2. UNITS               %
% 3. MATHS MACROS        %
% 4. GREEK UPPERCASE     %
% 5. XSPACE              %
% 6. FIGURES             %
% 7. FONTS               %
% 8. SUBEQUATION         %
%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%
% EDITING MACROS %
%%%%%%%%%%%%%%%%%%

% Natural spacing for author names in title page
\newcommand{\ns}[1]{\letterspace to 1.15\naturalwidth{#1}}

% \et = et al. for use in citations
\def\@etstop{%
  \ifx\@let@token.%
   \else.%
  \fi\xspace}
\def\etstop{\futurelet\@let@token\@etstop}
\def\et{{\it et al}\etstop}

%%%%%%%%%%%
%  UNITS  %
%%%%%%%%%%%

% Fixed unbreakable space separating numbers and their units
% e.g. 5\3cm (no need to group the unit)
\def\3{\kern2.5pt}

% Degrees Celcius (includes fixed space)
\def\C#1{\3$^\circ$C\protect{\xspace#1}}

%%%%%%%%%%%%%%%%
% MATHS MACROS %
%%%%%%%%%%%%%%%%

\def\be{\begin{equation}}
\def\ee{\end{equation}}

\def\bea{\begin{eqnarray}}
\def\eea{\end{eqnarray}}
\def\nn{\nonumber}

\def\longcaption#1{(#1)\par}

\def\dsty{\displaystyle}
\def\ssty{\scriptstyle}

\def\bzero{\mbox{\bf0}}    % Bold upright zero
\def\d{{\rm d}}            % Roman d for differential
\def\e{{\rm e}}            % Roman e for exponential
\def\i{{\rm i}}            % Roman i for imaginary number
\chardef\ii="10            % Reassign dotless i to \ii

\def\Re{\mathop{\rm Re}\nolimits}    % Real part
\def\Im{\mathop{\rm Im}\nolimits}    % Imaginary part
\def\Int{\mathop{\rm Int}\nolimits}  % Integer
\def\sgn{\mathop{\rm sgn}\nolimits}  % Sign
\def\tr{\mathop{\rm tr}\nolimits}  % Trace

\def\const{\mathop{\rm const.}\nolimits}    % Constant

\def\arccot{\mathop{\rm arccot}\nolimits}      % Inverse cotangent
\def\arcsec{\mathop{\rm arcsec}\nolimits}      % Inverse secant
\def\arccosec{\mathop{\rm arccosec}\nolimits}  % Inverse cosecant

\def\sech{\mathop{\rm sech}\nolimits}       % Hyperbolic secant
\def\cosech{\mathop{\rm cosech}\nolimits}   % Hyperbolic cosecant

\def\arcsinh{\mathop{\rm arsinh}\nolimits}    % Inverse hyperbolic sine
\def\arcosh{\mathop{\rm arcosh}\nolimits}     % Inverse hyperbolic cosine
\def\artanh{\mathop{\rm artanh}\nolimits}     % Inverse hyperbolic tangent
\def\arcoth{\mathop{\rm arcoth}\nolimits}     % Inverse hyperbolic cotangent
\def\arsech{\mathop{\rm arsech}\nolimits}     % Inverse hyperbolic secant
\def\arcosech{\mathop{\rm arcosech}\nolimits} % Inverse hyperbolic cosecant

\def\sn{\mathop{{\rm sn}}\nolimits}   % Standard
\def\cn{\mathop{{\rm cn}}\nolimits}   % Jacobian
\def\dn{\mathop{{\rm dn}}\nolimits}   % elliptic functions

\def\freerad{\dsty\cdot}   % Free radical

\def\smfr#1#2{{\textstyle\frac{#1}{#2}}}   % Small fraction

% Phantom zero for use in tables
\def\0{\phantom{0}}
%\hfill hack for math-mode
\def\shove{\hskip10000pt minus 1fil}

%%%%%%%%%%%%%%%%%%%%%%%%%%
% GREEK UPPERCASE MACROS %
%%%%%%%%%%%%%%%%%%%%%%%%%%

% Sloping Greek caps
\def\sDe{{\it\Delta}}
\def\sLa{{\it\Lambda}}
\def\sOm{{\it\Omega}}
\def\sSi{{\it\Sigma}}
\def\sTh{{\it\Theta}}
\def\sPh{{\it\Phi}}
\def\sPs{{\it\Psi}}
\def\sPi{{\it\Pi}}
\def\sGa{{\it\Gamma}}
\def\sUp{{\it\Upsilon}}
\def\sXi{{\it\Xi}}

% Bold Greek caps
\def\bDe{\bm{\Delta}}
\def\bLa{\bm{\Lambda}}
\def\bOm{\bm{\Omega}}
\def\bSi{\bm{\Sigma}}
\def\bTh{\bm{\Theta}}
\def\bPh{\bm{\Phi}}
\def\bPs{\bm{\Psi}}
\def\bPi{\bm{\Pi}}
\def\bGa{\bm{\Gamma}}
\def\bUp{\bm{\Upsilon}}
\def\bXi{\bm{\Xi}}

% Greek caps (\Pi, \Xi, \Psi, \Phi not defined)
\def\De{\Delta}
\def\La{\Lambda}
\def\Om{\Omega}
\def\Si{\Sigma}
\def\Th{\Theta}
\def\Ga{\Gamma}
\def\Up{\Upsilon}

%%%%%%%%%%
% XSPACE %
%%%%%%%%%%

% Inserts space after macro unless followed by punctuation.
% Cobbled from xspace.dtx (Copyright (C) 1991-1994 David 
% Carlisle) on tex archive. (Some possibilities added - PJ.)
\def\@xspace{%
  \ifx\@let@token\bgroup\else%
  \ifx\@let@token\egroup\else%
  \ifx\@let@token\/\else%
  \ifx\@let@token\ \else%
  \ifx\@let@token~\else%
  \ifx\@let@token.\else%
  \ifx\@let@token!\else%
  \ifx\@let@token,\else%
  \ifx\@let@token:\else%
  \ifx\@let@token;\else%
  \ifx\@let@token?\else%
  \ifx\@let@token'\else%
  \ifx\@let@token)\else%
  \ifx\@let@token-\else%
  \ifx\@let@token$\else%
  \ifx\@let@token/\else%
   \space%
   \fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi}
\newcommand{\xspace}{\futurelet\@let@token\@xspace}

%%%%%%%%%
% FONTS %
%%%%%%%%%

% Reassign lower case Greeks to be family-dependent 
% (so that \bm works) by substituting `7' for `0'
% in 1st column of Hex.
% PJ/JEW 11.8.95 (from lplain.tex)
\mathchardef\alpha="710B
\mathchardef\beta="710C
\mathchardef\gamma="710D
\mathchardef\delta="710E
\mathchardef\epsilon="710F
\mathchardef\zeta="7110
\mathchardef\eta="7111
\mathchardef\theta="7112
\mathchardef\iota="7113
\mathchardef\kappa="7114
\mathchardef\lambda="7115
\mathchardef\mu="7116
\mathchardef\nu="7117
\mathchardef\xi="7118
\mathchardef\pi="7119
\mathchardef\rho="711A
\mathchardef\sigma="711B
\mathchardef\tau="711C
\mathchardef\upsilon="711D
\mathchardef\phi="711E
\mathchardef\chi="711F
\mathchardef\psi="7120
\mathchardef\omega="7121
\mathchardef\varepsilon="7122
\mathchardef\vartheta="7123
\mathchardef\varpi="7124
\mathchardef\varrho="7125
\mathchardef\varsigma="7126
\mathchardef\varphi="7127

% Math Bold
% PJ/JEW 11.8.95 - define bold math italic font & redefined \bm
% PJ 5.9.95 - moved to rs.sty to enable rescaling in captions/footnotes
\newcommand{\bm}[1]{{\myboldmath #1}}

% Sans-serif
\font\sans=cmssi10
\def\sfm#1{\hbox{\sans #1}\,}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SUBEQUATION ENVIRONMENT %
%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcounter{subeqn}

\newenvironment{subequation}{%
\refstepcounter{equation}%
\setcounter{subeqn}{\value{equation}}%
\setcounter{equation}{0}%
\renewcommand{\theequation}{\protect{\thesubeqn\,$\alph{equation}$}}%
\ifappendix%
   \renewcommand{\thesubeqn}{\thesection\,\arabic{subeqn}}%
  \else%
   \renewcommand{\thesubeqn}{\thesection.\arabic{subeqn}}%
\fi}
{\setcounter{equation}{\value{subeqn}}%
 \setcounter{subeqn}{0}%
 \ifseqeqn%
   \renewcommand{\thesubeqn}{\arabic{equation}}%
  \else%
   \renewcommand{\thesubeqn}{\thesection.\arabic{equation}}%
\fi}
